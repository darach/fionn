<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 380" font-family="Inter, -apple-system, sans-serif">
  <defs>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="1" dy="1" stdDeviation="2" flood-opacity="0.1"/>
    </filter>
  </defs>

  <!-- Title -->
  <text x="400" y="30" text-anchor="middle" font-size="18" font-weight="700" fill="#111827">XOR Prefix: In-String State Detection</text>
  <text x="400" y="50" text-anchor="middle" font-size="11" fill="#6b7280">Source: Langdale &amp; Lemire (simdjson, 2019)</text>

  <!-- Input string visualization -->
  <g transform="translate(50, 75)">
    <text x="0" y="0" font-size="12" font-weight="600" fill="#374151">Input JSON:</text>

    <!-- Character boxes -->
    <g transform="translate(0, 15)">
      <!-- Characters -->
      <g font-family="JetBrains Mono, monospace" font-size="14">
        <rect x="0" y="0" width="30" height="30" rx="4" fill="#f3f4f6" stroke="#d1d5db"/>
        <text x="15" y="20" text-anchor="middle" fill="#374151">{</text>

        <rect x="35" y="0" width="30" height="30" rx="4" fill="#dbeafe" stroke="#3b82f6"/>
        <text x="50" y="20" text-anchor="middle" fill="#1e40af">"</text>

        <rect x="70" y="0" width="30" height="30" rx="4" fill="#bfdbfe" stroke="#93c5fd"/>
        <text x="85" y="20" text-anchor="middle" fill="#1e40af">n</text>

        <rect x="105" y="0" width="30" height="30" rx="4" fill="#bfdbfe" stroke="#93c5fd"/>
        <text x="120" y="20" text-anchor="middle" fill="#1e40af">a</text>

        <rect x="140" y="0" width="30" height="30" rx="4" fill="#bfdbfe" stroke="#93c5fd"/>
        <text x="155" y="20" text-anchor="middle" fill="#1e40af">m</text>

        <rect x="175" y="0" width="30" height="30" rx="4" fill="#bfdbfe" stroke="#93c5fd"/>
        <text x="190" y="20" text-anchor="middle" fill="#1e40af">e</text>

        <rect x="210" y="0" width="30" height="30" rx="4" fill="#dbeafe" stroke="#3b82f6"/>
        <text x="225" y="20" text-anchor="middle" fill="#1e40af">"</text>

        <rect x="245" y="0" width="30" height="30" rx="4" fill="#f3f4f6" stroke="#d1d5db"/>
        <text x="260" y="20" text-anchor="middle" fill="#374151">:</text>

        <rect x="280" y="0" width="30" height="30" rx="4" fill="#dcfce7" stroke="#22c55e"/>
        <text x="295" y="20" text-anchor="middle" fill="#15803d">"</text>

        <rect x="315" y="0" width="30" height="30" rx="4" fill="#bbf7d0" stroke="#86efac"/>
        <text x="330" y="20" text-anchor="middle" fill="#15803d">A</text>

        <rect x="350" y="0" width="30" height="30" rx="4" fill="#bbf7d0" stroke="#86efac"/>
        <text x="365" y="20" text-anchor="middle" fill="#15803d">l</text>

        <rect x="385" y="0" width="30" height="30" rx="4" fill="#bbf7d0" stroke="#86efac"/>
        <text x="400" y="20" text-anchor="middle" fill="#15803d">i</text>

        <rect x="420" y="0" width="30" height="30" rx="4" fill="#bbf7d0" stroke="#86efac"/>
        <text x="435" y="20" text-anchor="middle" fill="#15803d">c</text>

        <rect x="455" y="0" width="30" height="30" rx="4" fill="#bbf7d0" stroke="#86efac"/>
        <text x="470" y="20" text-anchor="middle" fill="#15803d">e</text>

        <rect x="490" y="0" width="30" height="30" rx="4" fill="#dcfce7" stroke="#22c55e"/>
        <text x="505" y="20" text-anchor="middle" fill="#15803d">"</text>

        <rect x="525" y="0" width="30" height="30" rx="4" fill="#f3f4f6" stroke="#d1d5db"/>
        <text x="540" y="20" text-anchor="middle" fill="#374151">}</text>
      </g>

      <!-- Position labels -->
      <g font-size="9" fill="#9ca3af">
        <text x="15" y="45" text-anchor="middle">0</text>
        <text x="50" y="45" text-anchor="middle">1</text>
        <text x="85" y="45" text-anchor="middle">2</text>
        <text x="120" y="45" text-anchor="middle">3</text>
        <text x="155" y="45" text-anchor="middle">4</text>
        <text x="190" y="45" text-anchor="middle">5</text>
        <text x="225" y="45" text-anchor="middle">6</text>
        <text x="260" y="45" text-anchor="middle">7</text>
        <text x="295" y="45" text-anchor="middle">8</text>
        <text x="330" y="45" text-anchor="middle">9</text>
        <text x="365" y="45" text-anchor="middle">10</text>
        <text x="400" y="45" text-anchor="middle">11</text>
        <text x="435" y="45" text-anchor="middle">12</text>
        <text x="470" y="45" text-anchor="middle">13</text>
        <text x="505" y="45" text-anchor="middle">14</text>
        <text x="540" y="45" text-anchor="middle">15</text>
      </g>
    </g>
  </g>

  <!-- Step 1: Quote positions -->
  <g transform="translate(50, 175)">
    <text x="0" y="0" font-size="12" font-weight="600" fill="#374151">Step 1: Identify quote positions</text>

    <g transform="translate(0, 15)" font-family="JetBrains Mono, monospace" font-size="12">
      <text x="0" y="0" fill="#6b7280">quote_bits:</text>
      <g transform="translate(100, -12)">
        <rect x="0" y="0" width="24" height="20" fill="#f3f4f6"/><text x="12" y="14" text-anchor="middle" fill="#9ca3af">0</text>
        <rect x="28" y="0" width="24" height="20" fill="#3b82f6"/><text x="40" y="14" text-anchor="middle" fill="white" font-weight="600">1</text>
        <rect x="56" y="0" width="24" height="20" fill="#f3f4f6"/><text x="68" y="14" text-anchor="middle" fill="#9ca3af">0</text>
        <rect x="84" y="0" width="24" height="20" fill="#f3f4f6"/><text x="96" y="14" text-anchor="middle" fill="#9ca3af">0</text>
        <rect x="112" y="0" width="24" height="20" fill="#f3f4f6"/><text x="124" y="14" text-anchor="middle" fill="#9ca3af">0</text>
        <rect x="140" y="0" width="24" height="20" fill="#f3f4f6"/><text x="152" y="14" text-anchor="middle" fill="#9ca3af">0</text>
        <rect x="168" y="0" width="24" height="20" fill="#3b82f6"/><text x="180" y="14" text-anchor="middle" fill="white" font-weight="600">1</text>
        <rect x="196" y="0" width="24" height="20" fill="#f3f4f6"/><text x="208" y="14" text-anchor="middle" fill="#9ca3af">0</text>
        <rect x="224" y="0" width="24" height="20" fill="#22c55e"/><text x="236" y="14" text-anchor="middle" fill="white" font-weight="600">1</text>
        <rect x="252" y="0" width="24" height="20" fill="#f3f4f6"/><text x="264" y="14" text-anchor="middle" fill="#9ca3af">0</text>
        <rect x="280" y="0" width="24" height="20" fill="#f3f4f6"/><text x="292" y="14" text-anchor="middle" fill="#9ca3af">0</text>
        <rect x="308" y="0" width="24" height="20" fill="#f3f4f6"/><text x="320" y="14" text-anchor="middle" fill="#9ca3af">0</text>
        <rect x="336" y="0" width="24" height="20" fill="#f3f4f6"/><text x="348" y="14" text-anchor="middle" fill="#9ca3af">0</text>
        <rect x="364" y="0" width="24" height="20" fill="#f3f4f6"/><text x="376" y="14" text-anchor="middle" fill="#9ca3af">0</text>
        <rect x="392" y="0" width="24" height="20" fill="#22c55e"/><text x="404" y="14" text-anchor="middle" fill="white" font-weight="600">1</text>
        <rect x="420" y="0" width="24" height="20" fill="#f3f4f6"/><text x="432" y="14" text-anchor="middle" fill="#9ca3af">0</text>
      </g>
    </g>
  </g>

  <!-- Step 2: XOR prefix result -->
  <g transform="translate(50, 235)">
    <text x="0" y="0" font-size="12" font-weight="600" fill="#374151">Step 2: Apply XOR prefix (each quote flips all subsequent bits)</text>

    <g transform="translate(0, 15)" font-family="JetBrains Mono, monospace" font-size="12">
      <text x="0" y="0" fill="#6b7280">in_string:</text>
      <g transform="translate(100, -12)">
        <rect x="0" y="0" width="24" height="20" fill="#f3f4f6"/><text x="12" y="14" text-anchor="middle" fill="#9ca3af">0</text>
        <rect x="28" y="0" width="24" height="20" fill="#3b82f6"/><text x="40" y="14" text-anchor="middle" fill="white" font-weight="600">1</text>
        <rect x="56" y="0" width="24" height="20" fill="#3b82f6"/><text x="68" y="14" text-anchor="middle" fill="white" font-weight="600">1</text>
        <rect x="84" y="0" width="24" height="20" fill="#3b82f6"/><text x="96" y="14" text-anchor="middle" fill="white" font-weight="600">1</text>
        <rect x="112" y="0" width="24" height="20" fill="#3b82f6"/><text x="124" y="14" text-anchor="middle" fill="white" font-weight="600">1</text>
        <rect x="140" y="0" width="24" height="20" fill="#3b82f6"/><text x="152" y="14" text-anchor="middle" fill="white" font-weight="600">1</text>
        <rect x="168" y="0" width="24" height="20" fill="#f3f4f6"/><text x="180" y="14" text-anchor="middle" fill="#9ca3af">0</text>
        <rect x="196" y="0" width="24" height="20" fill="#f3f4f6"/><text x="208" y="14" text-anchor="middle" fill="#9ca3af">0</text>
        <rect x="224" y="0" width="24" height="20" fill="#22c55e"/><text x="236" y="14" text-anchor="middle" fill="white" font-weight="600">1</text>
        <rect x="252" y="0" width="24" height="20" fill="#22c55e"/><text x="264" y="14" text-anchor="middle" fill="white" font-weight="600">1</text>
        <rect x="280" y="0" width="24" height="20" fill="#22c55e"/><text x="292" y="14" text-anchor="middle" fill="white" font-weight="600">1</text>
        <rect x="308" y="0" width="24" height="20" fill="#22c55e"/><text x="320" y="14" text-anchor="middle" fill="white" font-weight="600">1</text>
        <rect x="336" y="0" width="24" height="20" fill="#22c55e"/><text x="348" y="14" text-anchor="middle" fill="white" font-weight="600">1</text>
        <rect x="364" y="0" width="24" height="20" fill="#22c55e"/><text x="376" y="14" text-anchor="middle" fill="white" font-weight="600">1</text>
        <rect x="392" y="0" width="24" height="20" fill="#f3f4f6"/><text x="404" y="14" text-anchor="middle" fill="#9ca3af">0</text>
        <rect x="420" y="0" width="24" height="20" fill="#f3f4f6"/><text x="432" y="14" text-anchor="middle" fill="#9ca3af">0</text>
      </g>
    </g>
  </g>

  <!-- Result interpretation -->
  <g transform="translate(50, 295)">
    <rect width="700" height="70" rx="6" fill="#f0fdf4" stroke="#86efac" stroke-width="1"/>
    <text x="20" y="25" font-size="12" font-weight="600" fill="#166534">Result Interpretation:</text>
    <text x="20" y="45" font-size="11" fill="#374151">Structural characters at positions 0, 7, 15 are OUTSIDE strings (in_string = 0)</text>
    <text x="20" y="60" font-size="11" fill="#374151">Characters at positions 1-6 and 8-14 are INSIDE strings (in_string = 1) and should be ignored for bracket matching</text>
  </g>
</svg>